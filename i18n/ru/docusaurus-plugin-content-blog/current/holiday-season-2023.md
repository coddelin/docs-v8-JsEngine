---
title: &apos;V8 быстрее и безопаснее, чем когда-либо!&apos;
author: &apos;[Виктор Гомес](https://twitter.com/VictorBFG), эксперт по Глюхвейну&apos;
avatars:
  - victor-gomes
date: 2023-12-14
tags:
  - JavaScript
  - WebAssembly
  - безопасность
  - тесты производительности
description: "Впечатляющие достижения V8 в 2023 году"
tweet: &apos;&apos;
---

Добро пожаловать в захватывающий мир V8, где скорость — это не просто функция, а образ жизни. Наступил момент попрощаться с 2023 годом и отпраздновать впечатляющие достижения, которых V8 достиг в этом году.

Благодаря инновационным оптимизациям производительности V8 продолжает расширять границы возможного в постоянно меняющемся ландшафте Веба. Мы представили новый компилятор среднего уровня и реализовали множество улучшений в инфраструктуре компилятора высокого уровня, среде выполнения и сборщике мусора, что привело к значительному увеличению скорости работы.

<!--truncate-->
Помимо улучшений производительности, мы внедрили захватывающие новые функции как для JavaScript, так и для WebAssembly. Мы также предложили новый подход к эффективному переносу языков программирования с управляемой памятью в веб с помощью [WebAssembly Garbage Collection (WasmGC)](https://v8.dev/blog/wasm-gc-porting).

Но наша приверженность к совершенству на этом не заканчивается — мы также уделили большое внимание безопасности. Мы улучшили нашу инфраструктуру песочницы и внедрили [Контроль целостности потока выполнения (CFI)](https://en.wikipedia.org/wiki/Control-flow_integrity) в V8, обеспечивая более безопасную среду для пользователей.

Ниже мы выделили некоторые ключевые моменты этого года.

# Maglev: новый оптимизирующий компилятор среднего уровня

Мы представили новый оптимизирующий компилятор под названием [Maglev](https://v8.dev/blog/maglev), стратегически размещенный между нашими существующими компиляторами [Sparkplug](https://v8.dev/blog/sparkplug) и [TurboFan](https://v8.dev/docs/turbofan). Он выполняет роль высокоскоростного оптимизирующего компилятора, эффективно генерируя оптимизированный код с впечатляющей скоростью. Он генерирует код примерно в 20 раз медленнее, чем наш базовый не оптимизирующий компилятор Sparkplug, но в 10–100 раз быстрее, чем компилятор высокого уровня TurboFan. Мы наблюдали значительные улучшения производительности с Maglev: [JetStream](https://browserbench.org/JetStream2.1/) улучшился на 8.2%, а [Speedometer](https://browserbench.org/Speedometer2.1/) — на 6%. Более высокая скорость компиляции Maglev и уменьшенная зависимость от TurboFan привели к сокращению энергопотребления V8 на 10% в процессе выполнения Speedometer. [Хотя он еще не полностью завершен](https://en.m.wikipedia.org/wiki/Full-employment_theorem), текущая версия Maglev оправдала свой дебют в Chrome 117. Подробнее в нашем [блоге](https://v8.dev/blog/maglev).

# Turboshaft: новая архитектура для компилятора высокого уровня

Maglev не был нашей единственной инвестицией в улучшение технологий компиляции. Мы также внедрили Turboshaft, новую внутреннюю архитектуру нашего компилятора высокого уровня Turbofan, что сделало его не только проще в дальнейшем расширении новыми оптимизациями, но и быстрее в компиляции. Начиная с Chrome 120, все фазы бэкенда, не зависящие от ЦП, используют Turboshaft вместо Turbofan, и процесс компиляции проходит примерно в два раза быстрее, чем раньше. Это экономит энергию и создает основу для более впечатляющих приростов производительности в следующем году и далее. Следите за обновлениями!

# Более быстрый HTML-парсер

Мы обнаружили, что значительная часть времени наших тестов производительности уходит на обработку HTML. Хотя это напрямую и не связано с V8, мы решили применить наш опыт в оптимизации производительности для добавления более быстрого HTML-парсера в Blink. Эти изменения привели к заметному увеличению показателей Speedometer на 3.4%. Влияние на Chrome оказалось настолько положительным, что проект WebKit сразу же интегрировал эти изменения в [свой репозиторий](https://github.com/WebKit/WebKit/pull/9926). Мы гордимся своим вкладом в общую цель создания более быстрого интернета!

# Более эффективные DOM-выделения

Мы также активно работали над DOM. Были сделаны значительные оптимизации в стратегиях выделения памяти в [Oilpan](https://chromium.googlesource.com/v8/v8/+/main/include/cppgc/README.md) — выделителе для DOM-объектов. Он получил пул страниц, что значительно снизило стоимость обращения к ядру. Oilpan теперь поддерживает как сжатые, так и несжатые указатели, и мы избегаем сжатия полей с высокой нагрузкой в Blink. Учитывая, как часто осуществляется декомпрессия, это имело широкое влияние на производительность. Кроме того, зная, насколько быстро работает выделитель памяти, мы перевели на Oilpan классы, которые часто выделяются, что увеличило скорость операций выделения в 3 раза и показало значительное улучшение в тестах производительности, ориентированных на DOM, таких как Speedometer.

# Новые функции JavaScript

JavaScript продолжает развиваться с новыми стандартизированными функциями, и этот год не стал исключением. Мы добавили [масштабируемые ArrayBuffers](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer#resizing_arraybuffers) и [передачу ArrayBuffer](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer/transfer), String [`isWellFormed`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/isWellFormed) и [`toWellFormed`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/toWellFormed), [флаг `v` для RegExp](https://v8.dev/features/regexp-v-flag) (также известный как нотация множеств Unicode), [`JSON.parse` with source](https://github.com/tc39/proposal-json-parse-with-source), [группировка массивов](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/groupBy), [`Promise.withResolvers`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise/withResolvers) и [`Array.fromAsync`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/fromAsync). К сожалению, нам пришлось удалить [помощники для итераторов](https://github.com/tc39/proposal-iterator-helpers) после обнаружения несовместимости с вебом, но мы работали с TC39 для устранения этой проблемы и скоро снова реализуем данную функцию. Наконец, мы также сделали код ES6+ JS быстрее, [исключив избыточные проверки зоны временной мёртвости](https://docs.google.com/document/d/1klT7-tQpxtYbwhssRDKfUMEgm-NS3iUeMuApuRgZnAw/edit?usp=sharing) для привязок `let` и `const`.

# Обновления WebAssembly

В этом году для Wasm появилось множество новых функций и улучшений производительности. Мы добавили поддержку [multi-memory](https://github.com/WebAssembly/multi-memory), [tail-calls](https://github.com/WebAssembly/tail-call) (подробнее см. в [нашем блоге](https://v8.dev/blog/wasm-tail-call)) и [relaxed SIMD](https://github.com/WebAssembly/relaxed-simd) для обеспечения производительности нового уровня. Мы завершили реализацию [memory64](https://github.com/WebAssembly/memory64) для приложений с большими объемами памяти и ждем, когда предложение [достигнет четвертой стадии](https://github.com/WebAssembly/memory64/issues/43), чтобы мы смогли его внедрить! Мы включили последние обновления в [предложение по обработке исключений](https://github.com/WebAssembly/exception-handling), сохранив поддержку предыдущего формата. И мы продолжили инвестировать в [JSPI](https://v8.dev/blog/jspi) для [разблокировки еще одного крупного класса приложений в вебе](https://docs.google.com/document/d/16Us-pyte2-9DECJDfGm5tnUpfngJJOc8jbj54HMqE9Y/edit#bookmark=id.razn6wo5j2m). Оставайтесь с нами в следующем году!

# Сборка мусора в WebAssembly

Говоря о введении новых классов приложений в веб, мы наконец реализовали сборку мусора для WebAssembly (WasmGC) после нескольких лет работы над [стандартизацией](https://github.com/WebAssembly/gc/blob/main/proposals/gc/MVP.md)&apos;и [реализацией](https://bugs.chromium.org/p/v8/issues/detail?id=7748) этой функции. Теперь в Wasm появилась встроенная возможность выделения объектов и массивов, которые управляются существующим сборщиком мусора V8. Это позволяет компилировать приложения, написанные на Java, Kotlin, Dart и подобных языках, с использованием сборки мусора в Wasm, что обычно делает их в два раза быстрее, чем при компиляции в JavaScript. Подробности читайте в [нашем блоге](https://v8.dev/blog/wasm-gc-porting).

# Безопасность

В области безопасности наши три основные темы в этом году были песочницы, фаззинг и CFI. В области [песочниц](https://docs.google.com/document/d/1FM4fQmIhEqPG8uGp5o9A-mnPB5BOeScZYpkHjo0KKA8/edit?usp=sharing) мы сосредоточились на создании недостающей инфраструктуры, такой как таблица доверенных указателей и кода. В области фаззинга мы инвестировали в развитие инфраструктуры, создание специализированных фаззеров и улучшение охвата языков. Некоторые из наших работ были освещены в [этой презентации](https://www.youtube.com/watch?v=Yd9m7e9-pG0). Наконец, в области CFI мы заложили основу для нашей [архитектуры CFI](https://v8.dev/blog/control-flow-integrity), чтобы она могла быть реализована на как можно большем количестве платформ. Помимо этого, заслуживают внимания такие усилия, как работа над [снижением эффекта популярной техники эксплуатации уязвимостей](https://crbug.com/1445008) в `the_hole` и запуск новой программы вознаграждения за уязвимости в виде [V8CTF](https://github.com/google/security-research/blob/master/v8ctf/rules.md).

# Заключение

В течение года мы работали над многочисленными поэтапными улучшениями производительности. Совокупное влияние этих небольших проектов, а также описанных в блоге, огромно! Ниже приведены результаты тестирования, демонстрирующие улучшения производительности V8, достигнутые в 2023 году, общий рост составил `14%` для JetStream и впечатляющие `34%` для Speedometer.

![Показатели производительности веба, измеренные на 13-дюймовом MacBook Pro с M1.](/_img/holiday-season-2023/scores.svg)

Эти результаты показывают, что V8 быстрее и безопаснее, чем когда-либо. Пристегнитесь, разработчики, потому что с V8 путешествие в мир быстрого и стремительного веба только начинается! Мы стремимся оставить V8 лучшим движком JavaScript и WebAssembly на планете!

От всей команды V8 мы желаем вам радостного праздничного сезона, полного быстрых, безопасных и восхитительных впечатлений в Интернете!
