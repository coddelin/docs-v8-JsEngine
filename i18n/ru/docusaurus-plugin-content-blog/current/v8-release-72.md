---
title: 'Релиз V8 версии 7.2'
author: 'Андреас Хаас, обработчик ловушек'
avatars:
  - andreas-haas
date: 2018-12-18 11:48:21
tags:
  - релиз
description: 'V8 v7.2 включает в себя высокоскоростной парсинг JavaScript, более быстрый async-await, снижение потребления памяти на ia32, публичные поля классов и многое другое!'
tweet: '1074978755934863361'
---
Каждые шесть недель мы создаем новую ветвь V8 как часть нашего [процесса релиза](/docs/release-process). Каждая версия ответвляется от главной ветки Git V8 сразу перед бета-этапом Chrome. Сегодня мы рады представить нашу новейшую ветвь, [версию V8 7.2](https://chromium.googlesource.com/v8/v8.git/+log/branch-heads/7.2), которая находится в бета-версии до её релиза в стабильной версии Chrome 72 через несколько недель. V8 v7.2 содержит множество полезных функций для разработчиков. Этот пост предоставляет предварительный обзор некоторых ключевых моментов в преддверии релиза.

<!--truncate-->
## Память

[Встроенные функции](/blog/embedded-builtins) теперь поддерживаются и включены по умолчанию на архитектуре ia32.

## Производительность

### Парсинг JavaScript

В среднем веб-страницы тратят 9.5% времени на старте V8 на парсинг JavaScript. Поэтому мы сосредоточили усилия на выпуске самого быстрого парсера JavaScript в V8 версии 7.2. Мы значительно ускорили парсинг в целом. С версии 7.0 скорость парсинга увеличилась примерно на 30% на настольных компьютерах. Следующий график демонстрирует впечатляющие улучшения на нашем реальном тесте загрузки Facebook за последние месяцы.

![Время парсинга V8 на facebook.com (меньше - лучше)](/_img/v8-release-72/facebook-parse-time.png)

Мы фокусировались на улучшении парсера в разные периоды. Следующие графики показывают улучшения относительно последнего релиза v7.2 на нескольких популярных веб-сайтах.

![Время парсинга V8 относительно версии 7.2 (меньше - лучше)](/_img/v8-release-72/relative-parse-times.svg)

В целом, недавние улучшения сократили средний процент времени на парсинг с 9.5% до 7.5%, что привело к более быстрому времени загрузки и увеличению отзывчивости страниц.

### `async`/`await`

V8 версия 7.2 содержит [ускоренную реализацию `async`/`await`](/blog/fast-async#await-under-the-hood), которая включена по умолчанию. Мы сделали [предложение спецификации](https://github.com/tc39/ecma262/pull/1250) и сейчас собираем данные о совместимости с веб для того, чтобы изменения были официально добавлены в спецификацию ECMAScript.

### Элементы распространения (spread)

V8 версия 7.2 значительно улучшает производительность элементов распространения, когда они находятся в начале литерала массива, например `[...x]` или `[...x, 1, 2]`. Улучшение распространяется на массивы, строки, множества, ключи и значения карт, а также — через расширение — на `Array.from(x)`. Подробнее см. [наше подробное описание ускорения элементов распространения](/blog/spread-elements).

### WebAssembly

Мы проанализировали несколько тестов WebAssembly и использовали их для улучшения генерации кода на верхнем уровне выполнения. В частности, V8 v7.2 задействует разбиение узлов в планировщике оптимизирующего компилятора и ротацию циклов в бэкэнде. Мы также улучшили кэширование оболочек и ввели пользовательские оболочки, которые снижают затраты на вызов импортированных функций математики JavaScript. Кроме того, мы разработали изменения для распределителя регистров, которые улучшат производительность для многих типов кода, что будет реализовано в будущей версии.

### Обработчики ловушек

Обработчики ловушек улучшают общую пропускную способность кода WebAssembly. Они реализованы и доступны на Windows, macOS и Linux в V8 версии 7.2. В Chromium они включены на Linux. Windows и macOS последуют, когда будет подтверждена их стабильность. Мы также работаем над их доступностью на Android.

## Асинхронные трассировки стека

Как [упомянуто ранее](/blog/fast-async#improved-developer-experience), мы добавили новую функцию, называемую [асинхронные трассировки стека без затрат](https://bit.ly/v8-zero-cost-async-stack-traces), которая обогащает свойство `error.stack` асинхронными кадрами вызова. В настоящее время она доступна за командой `--async-stack-traces`.

## Особенности языка JavaScript

### Публичные поля классов

V8 версия 7.2 добавляет поддержку [публичных полей классов](/features/class-fields). Вместо следующего кода:

```js
class Animal {
  constructor(name) {
    this.name = name;
  }
}

class Cat extends Animal {
  constructor(name) {
    super(name);
    this.likesBaths = false;
  }
  meow() {
    console.log('Мяу!');
  }
}
```

…теперь вы можете написать:

```js
class Animal {
  constructor(name) {
    this.name = name;
  }
}

class Cat extends Animal {
  likesBaths = false;
  meow() {
    console.log('Мяу!');
  }
}
```

Поддержка [приватных полей классов](/features/class-fields#private-class-fields) запланирована в будущих релизах V8.

### `Intl.ListFormat`

V8 версия 7.2 добавляет поддержку [предложения `Intl.ListFormat`](/features/intl-listformat), позволяя локализованное форматирование списков.

```js
const lf = new Intl.ListFormat('en');
lf.format(['Франк']);
// → 'Франк'
lf.format(['Франк', 'Кристина']);
// → 'Франк и Кристина'
lf.format(['Франк', 'Кристина', 'Флора']);
// → 'Франк, Кристина и Флора'
lf.format(['Франк', 'Кристина', 'Флора', 'Харрисон']);
// → 'Франк, Кристина, Флора и Харрисон'
```

Для получения дополнительной информации и примеров использования ознакомьтесь с [нашим пояснением `Intl.ListFormat`](/features/intl-listformat).

### Корректный `JSON.stringify`

`JSON.stringify` теперь выводит escape-последовательности для одиночных суррогатов, делая его вывод допустимым в Unicode (и представимым в UTF-8):

```js
// Старое поведение:
JSON.stringify('\uD800');
// → '"�"'

// Новое поведение:
JSON.stringify('\uD800');
// → '"\\ud800"'
```

Для получения дополнительной информации см. [наше пояснение корректного `JSON.stringify`](/features/well-formed-json-stringify).

### Экспорт пространств имен модулей

В [модулях JavaScript](/features/modules) уже можно было использовать следующий синтаксис:

```js
import * as utils from './utils.mjs';
```

Однако симметричного синтаксиса `export` не существовало… [до сих пор](/features/module-namespace-exports):

```js
export * as utils from './utils.mjs';
```

Это эквивалентно следующему:

```js
import * as utils from './utils.mjs';
export { utils };
```

## API V8

Пожалуйста, используйте `git log branch-heads/7.1..branch-heads/7.2 include/v8.h`, чтобы получить список изменений API.

Разработчики с [активной версией V8](/docs/source-code#using-git) могут использовать `git checkout -b 7.2 -t branch-heads/7.2`, чтобы протестировать новые функции в V8 v7.2. Альтернативно, вы можете [подписаться на Beta-канал Chrome](https://www.google.com/chrome/browser/beta.html) и скоро попробовать новые функции самостоятельно.
