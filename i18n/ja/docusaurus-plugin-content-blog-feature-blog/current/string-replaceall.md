---
title: "`String.prototype.replaceAll`"
author: "Mathias Bynens ([@mathias](https://twitter.com/mathias))"
avatars: 
  - "mathias-bynens"
date: 2019-11-11
tags: 
  - ECMAScript
  - ES2021
  - Node.js 16
description: "JavaScript ã¯ã€`String.prototype.replaceAll` API ã‚’ä½¿ç”¨ã—ã¦ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªéƒ¨åˆ†æ–‡å­—åˆ—ç½®æ›ã«ç›´æ¥å¯¾å¿œã™ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚"
tweet: "1193917549060280320"
---
JavaScript ã§æ–‡å­—åˆ—ã‚’æ‰±ã£ãŸã“ã¨ãŒã‚ã‚‹ãªã‚‰ã€`String#replace` ãƒ¡ã‚½ãƒƒãƒ‰ã«å‡ºä¼šã£ãŸã“ã¨ãŒã‚ã‚‹ã§ã—ã‚‡ã†ã€‚`String.prototype.replace(searchValue, replacement)` ã¯æŒ‡å®šã•ã‚ŒãŸãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ã«åŸºã¥ã„ã¦ä¸€è‡´ã™ã‚‹éƒ¨åˆ†ã‚’ç½®æ›ã—ãŸçµæœã®æ–‡å­—åˆ—ã‚’è¿”ã—ã¾ã™:

<!--truncate-->
```js
'abc'.replace('b', '_');
// â†’ 'a_c'

'ğŸğŸ‹ğŸŠğŸ“'.replace('ğŸ', 'ğŸ¥­');
// â†’ 'ğŸ¥­ğŸ‹ğŸŠğŸ“'
```

ã‚ˆãã‚ã‚‹ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¨ã—ã¦ã€ç‰¹å®šã®éƒ¨åˆ†æ–‡å­—åˆ—ã®ã™ã¹ã¦ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ç½®æ›ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã—ã‹ã— `String#replace` ã¯ã“ã®ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«ç›´æ¥å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚`searchValue` ãŒæ–‡å­—åˆ—ã®å ´åˆã€éƒ¨åˆ†æ–‡å­—åˆ—ã®æœ€åˆã®ä¸€è‡´ã—ã‹ç½®æ›ã•ã‚Œã¾ã›ã‚“:

```js
'aabbcc'.replace('b', '_');
// â†’ 'aa_bcc'

'ğŸğŸğŸ‹ğŸ‹ğŸŠğŸŠğŸ“ğŸ“'.replace('ğŸ', 'ğŸ¥­');
// â†’ 'ğŸ¥­ğŸğŸ‹ğŸ‹ğŸŠğŸŠğŸ“ğŸ“'
```

ã“ã‚Œã‚’å›é¿ã™ã‚‹ãŸã‚ã«ã€é–‹ç™ºè€…ã¯æ¤œç´¢å¯¾è±¡ã®æ–‡å­—åˆ—ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ« (`g`) ãƒ•ãƒ©ã‚°ä»˜ãã®æ­£è¦è¡¨ç¾ã«å¤‰æ›ã™ã‚‹ã“ã¨ãŒã‚ˆãã‚ã‚Šã¾ã™ã€‚ã“ã†ã™ã‚‹ã¨ `String#replace` ã¯ã™ã¹ã¦ã®ä¸€è‡´ã‚’ç½®æ›ã—ã¾ã™:

```js
'aabbcc'.replace(/b/g, '_');
// â†’ 'aa__cc'

'ğŸğŸğŸ‹ğŸ‹ğŸŠğŸŠğŸ“ğŸ“'.replace(/ğŸ/g, 'ğŸ¥­');
// â†’ 'ğŸ¥­ğŸ¥­ğŸ‹ğŸ‹ğŸŠğŸŠğŸ“ğŸ“'
```

é–‹ç™ºè€…ã¨ã—ã¦ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªéƒ¨åˆ†æ–‡å­—åˆ—ç½®æ›ãŒæ¬²ã—ã„ã ã‘ãªã®ã«ã€ã“ã®æ–‡å­—åˆ—ã‚’æ­£è¦è¡¨ç¾ã«å¤‰æ›ã—ãªã„ã¨ã„ã‘ãªã„ã®ã¯é¢å€’ã§ã™ã€‚ãã‚Œä»¥ä¸Šã«ã€ã“ã®å¤‰æ›ã¯ãƒŸã‚¹ã‚’ç”Ÿã¿ã‚„ã™ãã€ä¸€èˆ¬çš„ãªãƒã‚°ã®å…ƒã§ã™ï¼ä»¥ä¸‹ã®ä¾‹ã‚’è€ƒãˆã¦ã¿ã¦ãã ã•ã„:

```js
const queryString = 'q=query+string+parameters';

queryString.replace('+', ' ');
// â†’ 'q=query string+parameters' âŒ
// æœ€åˆã®ä¸€è‡´ã—ã‹ç½®æ›ã•ã‚Œã¾ã›ã‚“ã€‚

queryString.replace(/+/, ' ');
// â†’ SyntaxError: invalid regular expression âŒ
// å®Ÿéš› `+` ã¯æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¸­ã§ç‰¹åˆ¥ãªæ„å‘³ã‚’æŒã¤æ–‡å­—ã§ã™ã€‚

queryString.replace(/\+/, ' ');
// â†’ 'q=query string+parameters' âŒ
// æ­£è¦è¡¨ç¾ã®ç‰¹åˆ¥ãªæ–‡å­—ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã™ã‚Œã°æ­£è¦è¡¨ç¾ã¯æœ‰åŠ¹ã«ãªã‚Šã¾ã™ãŒã€
// ã“ã‚Œã§ã‚‚ã¾ã æ–‡å­—åˆ—å†…ã®æœ€åˆã® `+` ã®ä¸€è‡´ã—ã‹ç½®æ›ã•ã‚Œã¾ã›ã‚“ã€‚

queryString.replace(/\+/g, ' ');
// â†’ 'q=query string parameters' âœ…
// ç‰¹åˆ¥ãªæ­£è¦è¡¨ç¾ã®æ–‡å­—ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ã€ã‹ã¤ `g` ãƒ•ãƒ©ã‚°ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§æ©Ÿèƒ½ã—ã¾ã™ã€‚
```

`'+'` ã®ã‚ˆã†ãªæ–‡å­—åˆ—ãƒªãƒ†ãƒ©ãƒ«ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªæ­£è¦è¡¨ç¾ã«å¤‰æ›ã™ã‚‹ã®ã¯ã€ãŸã å˜ã« `'` ã‚’å‰Šé™¤ã—ã€æ­£è¦è¡¨ç¾ç”¨ã®ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ `/` ã§å›²ã¿ã€`g` ãƒ•ãƒ©ã‚°ã‚’è¿½åŠ ã™ã‚Œã°ã‚ˆã„ã ã‘ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚æ­£è¦è¡¨ç¾å†…ã§ç‰¹åˆ¥ãªæ„å‘³ã‚’æŒã¤æ–‡å­—ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ç°¡å˜ã«å¿˜ã‚Œã‚‰ã‚ŒãŒã¡ã§ã€æ­£ç¢ºã«å®Ÿè¡Œã™ã‚‹ã®ãŒé›£ã—ã„ã§ã™ã€‚JavaScript ãŒæ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã™ã‚‹çµ„ã¿è¾¼ã¿ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’æä¾›ã—ã¦ã„ãªã„ãŸã‚ã§ã™ã€‚

ä»£æ›¿ã®å›é¿ç­–ã¨ã—ã¦ `String#split` ã‚’ `Array#join` ã¨çµ„ã¿åˆã‚ã›ã‚‹æ–¹æ³•ãŒã‚ã‚Šã¾ã™:

```js
const queryString = 'q=query+string+parameters';
queryString.split('+').join(' ');
// â†’ 'q=query string parameters'
```

ã“ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã¯ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚’ä¼´ã†å•é¡Œã‚’å›é¿ã—ã¾ã™ãŒã€æ–‡å­—åˆ—ã‚’éƒ¨åˆ†ã«åˆ†å‰²ã—ã€ãã‚Œã‚’å†ã³çµåˆã™ã‚‹ã¨ã„ã†ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãŒç™ºç”Ÿã—ã¾ã™ã€‚

ã“ã‚Œã‚‰å›é¿ç­–ã®ã©ã‚Œã‚‚ãŒç†æƒ³çš„ã§ã¯ãªã„ã®ã¯æ˜ã‚‰ã‹ã§ã™ã€‚JavaScript ã§ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªéƒ¨åˆ†æ–‡å­—åˆ—ç½®æ›ã¨ã„ã†åŸºæœ¬çš„ãªæ“ä½œãŒã‚‚ã£ã¨ç°¡å˜ã«ã§ãã‚Œã°ç´ æ™´ã‚‰ã—ã„ã¨æ€ã„ã¾ã›ã‚“ã‹ï¼Ÿ

## `String.prototype.replaceAll`

æ–°ã—ã„ `String#replaceAll` ãƒ¡ã‚½ãƒƒãƒ‰ã¯ã“ã‚Œã‚‰ã®å•é¡Œã‚’è§£æ±ºã—ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªéƒ¨åˆ†æ–‡å­—åˆ—ç½®æ›ã‚’è¡Œã†ãŸã‚ã®ç°¡æ½”ãªãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã‚’æä¾›ã—ã¾ã™:

```js
'aabbcc'.replaceAll('b', '_');
// â†’ 'aa__cc'

'ğŸğŸğŸ‹ğŸ‹ğŸŠğŸŠğŸ“ğŸ“'.replaceAll('ğŸ', 'ğŸ¥­');
// â†’ 'ğŸ¥­ğŸ¥­ğŸ‹ğŸ‹ğŸŠğŸŠğŸ“ğŸ“'

const queryString = 'q=query+string+parameters';
queryString.replaceAll('+', ' ');
// â†’ 'q=query string parameters'
```

è¨€èªå†…ã®æ—¢å­˜ã® API ã¨æ•´åˆæ€§ã‚’ä¿ã¤ãŸã‚ã«ã€`String.prototype.replaceAll(searchValue, replacement)` ã¯ `String.prototype.replace(searchValue, replacement)` ã¨å…¨ãåŒã˜ã‚ˆã†ã«å‹•ä½œã—ã¾ã™ãŒã€ä»¥ä¸‹ã® 2 ç‚¹ã‚’é™¤ã„ã¦ã¯ãã†ã§ã™:

1. `searchValue` ãŒæ–‡å­—åˆ—ã®å ´åˆã€`String#replace` ã¯éƒ¨åˆ†æ–‡å­—åˆ—ã®æœ€åˆã®ä¸€è‡´ã®ã¿ã‚’ç½®æ›ã—ã¾ã™ãŒã€`String#replaceAll` ã¯ã™ã¹ã¦ã®ä¸€è‡´ã‚’ç½®æ›ã—ã¾ã™ã€‚
1. `searchValue` ãŒã‚°ãƒ­ãƒ¼ãƒãƒ«ã§ãªã„æ­£è¦è¡¨ç¾ã®å ´åˆã€`String#replace` ã¯æ–‡å­—åˆ—ã®å ´åˆã¨åŒæ§˜ã«å˜ä¸€ã®ä¸€è‡´ã®ã¿ã‚’ç½®æ›ã—ã¾ã™ã€‚ä¸€æ–¹ `String#replaceAll` ã¯ã“ã®å ´åˆã«ã¯ä¾‹å¤–ã‚’ã‚¹ãƒ­ãƒ¼ã—ã¾ã™ã€‚ã“ã‚Œã¯ãŠãã‚‰ãã‚¨ãƒ©ãƒ¼ã§ã‚ã‚Šã€ã™ã¹ã¦ã®ä¸€è‡´ã‚’ã€Œç½®æ›ã€ã—ãŸã„å ´åˆã¯ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªæ­£è¦è¡¨ç¾ã‚’ä½¿ç”¨ã—ã€å˜ä¸€ã®ä¸€è‡´ã®ã¿ã‚’ç½®æ›ã—ãŸã„å ´åˆã¯ `String#replace` ã‚’ä½¿ç”¨ã™ã‚‹ã¹ãã ã‹ã‚‰ã§ã™ã€‚

æ–°æ©Ÿèƒ½ã®é‡è¦ãªéƒ¨åˆ†ã¯æœ€åˆã®é …ç›®ã«ã‚ã‚Šã¾ã™ã€‚`String.prototype.replaceAll` ã¯æ­£è¦è¡¨ç¾ã‚„ãã®ä»–ã®å›é¿ç­–ã‚’ä½¿ç”¨ã›ãšã«ã€ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªéƒ¨åˆ†æ–‡å­—åˆ—ç½®æ›ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹ãŸã‚ã®åˆç´šã‚¯ãƒ©ã‚¹æ©Ÿèƒ½ã‚’ JavaScript ã«è¿½åŠ ã—ã¾ã™ã€‚

## ç‰¹æ®Šãªç½®æ›ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã¤ã„ã¦ã®æ³¨æ„

æ³¨ç›®ã™ã¹ãç‚¹: `replace` ã¨ `replaceAll` ã®ä¸¡æ–¹ã¯[ç‰¹æ®Šãªç½®æ›ãƒ‘ã‚¿ãƒ¼ãƒ³](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replace#specifying_a_string_as_the_replacement)ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã¯æ­£è¦è¡¨ç¾ã¨çµ„ã¿åˆã‚ã›ã¦ä½¿ç”¨ã™ã‚‹ã®ãŒæœ€ã‚‚ä¾¿åˆ©ã§ã™ãŒã€ãã®ã†ã¡ã„ãã¤ã‹ï¼ˆ`$$`, `$&`, ``$` ``, `$'`ï¼‰ã¯å˜ç´”ãªæ–‡å­—åˆ—ç½®æ›ã‚’è¡Œã†å ´åˆã§ã‚‚åŠ¹æœã‚’ç™ºæ®ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã€é©šãã“ã¨ãŒã‚ã‚Šã¾ã™:

```js
'xyz'.replaceAll('y', '$$');
// â†’ 'x$z' ï¼ˆ'x$$z' ã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰
```

ã“ã‚Œã‚‰ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã„ãšã‚Œã‹ãŒç½®æ›æ–‡å­—åˆ—ã«å«ã¾ã‚Œã¦ãŠã‚Šã€ãã‚Œã‚’ãã®ã¾ã¾ä½¿ç”¨ã—ãŸã„å ´åˆã€æ–‡å­—åˆ—ã‚’è¿”ã™ç½®æ›é–¢æ•°ã‚’ä½¿ç”¨ã—ã¦é­”æ³•ã®ã‚ˆã†ãªç½®æ›å‹•ä½œã‚’ã‚ªãƒ—ãƒˆã‚¢ã‚¦ãƒˆã§ãã¾ã™:

```js
'xyz'.replaceAll('y', () => '$$');
// â†’ 'x$$z'
```

## `String.prototype.replaceAll` ã®ã‚µãƒãƒ¼ãƒˆ

<feature-support chrome="85 https://bugs.chromium.org/p/v8/issues/detail?id=9801"
                 firefox="77 https://bugzilla.mozilla.org/show_bug.cgi?id=1608168#c8"
                 safari="13.1 https://webkit.org/blog/10247/new-webkit-features-in-safari-13-1/"
                 nodejs="16"
                 babel="yes https://github.com/zloirock/core-js#ecmascript-string-and-regexp"></feature-support>
